<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width; initial-scale=1.0" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>Benchmarker.py README</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="benchmarker-py-readme">
<h1 class="title">Benchmarker.py README</h1>

<div class="line-block">
<div class="line">$Release: 0.0.0 $</div>
<div class="line">$License: Public Domain $</div>
<div class="line">$Copyright: copyright(c) 2010-2014 kuwata-lab.com all rights reserved. $</div>
</div>
<div class="section" id="overview">
<h1>Overview</h1>
<p>Benchmarker.py is an awesome benchmarking tool for Python.</p>
<ul class="simple">
<li>Easy to use</li>
<li>Pretty good output (including JSON format)</li>
<li>Available on Python &gt;= 2.5 and &gt;= 3.0</li>
</ul>
<div class="section" id="install">
<h2>Install</h2>
<p><a class="reference external" href="http://pypi.python.org/pypi/Benchmarker/">http://pypi.python.org/pypi/Benchmarker/</a></p>
<pre class="literal-block">
$ sudo pip install Benchmarker
## or
$ sudo easy_install Benchmarker
## or
$ wget http://pypi.python.org/packages/source/B/Benchmarker/Benchmarker-X.X.X.tar.gz
$ tar xzf Benchmarker-X.X.X.tar.gz
$ cd Benchmarker-X.X.X/
$ sudo python setup.py install
</pre>
</div>
</div>
<div class="section" id="step-by-step-tutorial">
<h1>Step by Step Tutorial</h1>
<div class="section" id="basic-usage">
<h2>Basic Usage</h2>
<p>Example (ex1.py):</p>
<pre class="literal-block">
<strong>from benchmarker import Benchmarker</strong>
try:
    xrange
except NameError:
    xrange = range       # for Python3

loop = 1000 * 1000
<strong>with Benchmarker(width=20) as bench:</strong>
    s1, s2, s3, s4, s5 = "Haruhi", "Mikuru", "Yuki", "Itsuki", "Kyon"

    <strong>@bench("join")</strong>
    def _(<strong>bm</strong>):
        for _ in xrange(loop):
            sos = ''.join((s1, s2, s3, s4, s5))

    <strong>@bench("concat")</strong>
    def _(<strong>bm</strong>):
        for _ in xrange(loop):
            sos = s1 + s2 + s3 + s4 + s5

    <strong>@bench("format")</strong>
    def _(<strong>bm</strong>):
        for _ in xrange(loop):
            sos = '%s%s%s%s%s' % (s1, s2, s3, s4, s5)
</pre>
<p>Output example:</p>
<pre class="literal-block">
$ python ex1.py
## benchmarker:         release 0.0.0 (for python)
## python version:      3.4.2
## python compiler:     GCC 4.8.2
## python platform:     Linux-3.13.0-36-generic-x86_64-with-debian-jessie-sid
## python executable:   /opt/vs/python/3.4.2/bin/python
## cpu model:           Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz  # 2494.050 MHz
## parameters:          loop=1, cycle=1, extra=0

##                        real    (total    = user    + sys)
join                    0.2892    0.2900    0.2900    0.0000
concat                  0.3889    0.3800    0.3800    0.0000
format                  0.4496    0.4500    0.4500    0.0000

## Ranking                real
join                    0.2892  (100.0) ********************
concat                  0.3889  ( 74.4) ***************
format                  0.4496  ( 64.3) *************

## Matrix                 real    [01]    [02]    [03]
[01] join               0.2892   100.0   134.5   155.5
[02] concat             0.3889    74.4   100.0   115.6
[03] format             0.4496    64.3    86.5   100.0
</pre>
</div>
<div class="section" id="number-of-loop">
<h2>Number of Loop</h2>
<p>You can specify number of loop in script and/or command-line option.</p>
<p>Example (ex2.py):</p>
<pre class="literal-block">
from benchmarker import Benchmarker

## specify number of loop
with Benchmarker(<strong>1000*1000</strong>, width=20) as bench:
    s1, s2, s3, s4, s5 = "Haruhi", "Mikuru", "Yuki", "Itsuki", "Kyon"

    @bench("join")
    def _(bm):
        for i in <strong>bm</strong>:      ## instead of xrange(N)
            sos = ''.join((s1, s2, s3, s4, s5))

    @bench("concat")
    def _(bm):
        for i in <strong>bm</strong>:
            sos = s1 + s2 + s3 + s4 + s5

    @bench("format")
    def _(bm):
        for i in <strong>bm</strong>:
            sos = '%s%s%s%s%s' % (s1, s2, s3, s4, s5)
</pre>
<p>Output Example:</p>
<pre class="literal-block">
$ python ex2.py   # or python ex2.py <strong>-n 1000000</strong>
## benchmarker:         release 0.0.0 (for python)
## python version:      3.4.2
## python compiler:     GCC 4.8.2
## python platform:     Linux-3.13.0-36-generic-x86_64-with-debian-jessie-sid
## python executable:   /opt/vs/python/3.4.2/bin/python
## cpu model:           Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz  # 2494.050 MHz
## parameters:          loop=1000000, cycle=1, extra=0

##                        real    (total    = user    + sys)
join                    0.2960    0.3000    0.3000    0.0000
concat                  0.3946    0.3900    0.3900    0.0000
format                  0.4430    0.4500    0.4500    0.0000

## Ranking                real
join                    0.2960  (100.0) ********************
concat                  0.3946  ( 75.0) ***************
format                  0.4430  ( 66.8) *************

## Matrix                 real    [01]    [02]    [03]
[01] join               0.2960   100.0   133.3   149.7
[02] concat             0.3946    75.0   100.0   112.3
[03] format             0.4430    66.8    89.1   100.0
</pre>
</div>
<div class="section" id="empty-loop">
<h2>Empty Loop</h2>
<p>'Empty loop' is used to subtract time for loop from entire time.</p>
<p>Example (ex3.py):</p>
<pre class="literal-block">
from benchmarker import Benchmarker

## specify number of loop
with Benchmarker(1000*1000, width=20) as bench:
    s1, s2, s3, s4, s5 = "Haruhi", "Mikuru", "Yuki", "Itsuki", "Kyon"

    <strong>@bench(None)</strong>                ## !!!!! empty loop
    <strong>def _(bm):</strong>
        <strong>for i in bm:</strong>
            <strong>pass</strong>

    @bench("join")
    def _(bm):
        for i in bm:
            sos = ''.join((s1, s2, s3, s4, s5))

    @bench("concat")
    def _(bm):
        for i in bm:
            sos = s1 + s2 + s3 + s4 + s5

    @bench("format")
    def _(bm):
        for i in bm:
            sos = '%s%s%s%s%s' % (s1, s2, s3, s4, s5)
</pre>
<p>Output Example:</p>
<pre class="literal-block">
$ python ex3.py
## benchmarker:         release 0.0.0 (for python)
## python version:      3.4.2
## python compiler:     GCC 4.8.2
## python platform:     Linux-3.13.0-36-generic-x86_64-with-debian-jessie-sid
## python executable:   /opt/vs/python/3.4.2/bin/python
## cpu model:           Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz  # 2494.050 MHz
## parameters:          loop=1000000, cycle=1, extra=0

##                        real    (total    = user    + sys)
<strong>(Empty)                 0.0236    0.0200    0.0200    0.0000</strong>
join                    <strong>0.2779</strong>    0.2800    0.2800    0.0000
concat                  <strong>0.3792</strong>    0.3800    0.3800    0.0000
format                  <strong>0.4233</strong>    0.4300    0.4300    0.0000

## Ranking                real
join                    0.2779  (100.0) ********************
concat                  0.3792  ( 73.3) ***************
format                  0.4233  ( 65.6) *************

## Matrix                 real    [01]    [02]    [03]
[01] join               0.2779   100.0   136.5   152.3
[02] concat             0.3792    73.3   100.0   111.6
[03] format             0.4233    65.6    89.6   100.0
</pre>
<p>For example, actual time of 'join' entry is 0.3015 (= 0.2779 + 0.0236).
In other words, real time (0.2779) is already subtracted empty loop time (0.0236).</p>
</div>
<div class="section" id="iteration-and-average">
<h2>Iteration and Average</h2>
<p>It is possible to iterate all benchmarks. Average of results are calculated
automatically.</p>
<ul class="simple">
<li><tt class="docutils literal">Benchmark(cycle=3)</tt> or <tt class="docutils literal"><span class="pre">-c</span> 3</tt> option iterates all benchmarks 3 times
and reports average of benchmarks.</li>
<li><tt class="docutils literal">Benchmark(extra=1)</tt> or <tt class="docutils literal"><span class="pre">-x</span> 1</tt> option increases number of iterations
by <tt class="docutils literal">2*1</tt> times, and excludes min and max result from average.</li>
<li><tt class="docutils literal">Benchmark(cycle=3, extra=1)</tt> or <tt class="docutils literal"><span class="pre">-c</span> 3 <span class="pre">-x</span> 1</tt> option iterates benchmarks
5 (= 3+2*1) times, excludes min and max results, and calculates averages
from 3 results.</li>
</ul>
<p>Example (ex4.py):</p>
<pre class="literal-block">
from benchmarker import Benchmarker

with Benchmarker(1000*1000, width=25, <strong>cycle=3, extra=1</strong>) as bench:
    s1, s2, s3, s4, s5 = "Haruhi", "Mikuru", "Yuki", "Itsuki", "Kyon"

    @bench(None)
    def _(bm):
        for i in bm:
            pass

    @bench("join")
    def _(bm):
        for i in bm:    ## !!!!! instead of xrange(N)
            sos = ''.join((s1, s2, s3, s4, s5))

    @bench("concat")
    def _(bm):
        for i in bm:
            sos = s1 + s2 + s3 + s4 + s5

    @bench("format")
    def _(bm):
        for i in bm:
            sos = '%s%s%s%s%s' % (s1, s2, s3, s4, s5)
</pre>
<p>Output Example:</p>
<pre class="literal-block">
$ python ex4.py     # or python ex4.py <strong>-c 3 -x 1</strong>
## benchmarker:         release 0.0.0 (for python)
## python version:      3.4.2
## python compiler:     GCC 4.8.2
## python platform:     Linux-3.13.0-36-generic-x86_64-with-debian-jessie-sid
## python executable:   /opt/vs/python/3.4.2/bin/python
## cpu model:           Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz  # 2494.050 MHz
## parameters:          loop=1000000, cycle=3, extra=1

## <strong>(#1)</strong>                        real    (total    = user    + sys)
(Empty)                      0.0246    0.0300    0.0300    0.0000
join                         0.2705    0.2600    0.2600    0.0000
concat                       0.3776    0.3800    0.3800    0.0000
format                       0.4102    0.4000    0.4000    0.0000

## <strong>(#2)</strong>                        real    (total    = user    + sys)
(Empty)                      0.0243    0.0200    0.0200    0.0000
join                         0.2737    0.2800    0.2800    0.0000
concat                       0.3791    0.3900    0.3900    0.0000
format                       0.4087    0.4100    0.4100    0.0000

## <strong>(#3)</strong>                        real    (total    = user    + sys)
(Empty)                      0.0237    0.0200    0.0200    0.0000
join                         0.2686    0.2700    0.2700    0.0000
concat                       0.3719    0.3800    0.3800    0.0000
format                       0.4047    0.4100    0.4100    0.0000

## <strong>(#4)</strong>                        real    (total    = user    + sys)
(Empty)                      0.0236    0.0200    0.0200    0.0000
join                         0.2660    0.2700    0.2700    0.0000
concat                       0.3749    0.3800    0.3800    0.0000
format                       0.4083    0.4100    0.4100    0.0000

## <strong>(#5)</strong>                        real    (total    = user    + sys)
(Empty)                      0.0246    0.0300    0.0300    0.0000
join                         0.2720    0.2600    0.2600    0.0000
concat                       0.3754    0.3700    0.3700    0.0000
format                       0.4132    0.4100    0.4100    0.0000

<strong>## Ignore min &amp; max             min     cycle       max     cycle</strong>
<strong>join                         0.2660      (#4)    0.2737      (#2)</strong>
<strong>concat                       0.3719      (#3)    0.3791      (#2)</strong>
<strong>format                       0.4047      (#3)    0.4132      (#5)</strong>

<strong>## Average of 3 (=5-2*1)       real    (total    = user    + sys)</strong>
<strong>join                         0.2704    0.2633    0.2633    0.0000</strong>
<strong>concat                       0.3759    0.3767    0.3767    0.0000</strong>
<strong>format                       0.4091    0.4067    0.4067    0.0000</strong>

## Ranking                     real
join                         0.2704  (100.0) ********************
concat                       0.3759  ( 71.9) **************
format                       0.4091  ( 66.1) *************

## Matrix                      real    [01]    [02]    [03]
[01] join                    0.2704   100.0   139.1   151.3
[02] concat                  0.3759    71.9   100.0   108.8
[03] format                  0.4091    66.1    91.9   100.0
</pre>
</div>
</div>
<div class="section" id="advanced-topics">
<h1>Advanced Topics</h1>
<div class="section" id="output-in-json-format">
<h2>Output in JSON format</h2>
<p>Command-line <tt class="docutils literal"><span class="pre">-o</span> file</tt> option will output benchmark data into <tt class="docutils literal">file</tt>
in JSON format.</p>
<pre class="literal-block">
$ python mybench.py <strong>-o result.json</strong>
....(snip)...
$ less result.json
</pre>
</div>
<div class="section" id="setup-and-teardown">
<h2>Setup and Teardown</h2>
<p>If each benchmark requires setup or teardown code which takes long time,
wrap true-benchmark block by <tt class="docutils literal">with bm:</tt> in order to exclude setup and
teardown time.</p>
<p>Example:</p>
<pre class="literal-block">
from benchmarker import Benchmarker

with Benchmarker(1000) as bench:

    @bench("Django template engine"):
    def _(bm):
        ## setup
        import django
        import django.template
        with open("example.html") as f:
            tmpl = django.template.Template(f.read())
        context = django.template.Context({"items": ["A", "B", "C"]})

        ## run benchmark, excluding setup and teardown time
        <strong>with bm:</strong>            # !!!!!
            for _ in bm:
                output = tmpl.render(context)

        ## teardown
        with open("example.expected") as f:
            expected = f.read()
        assert output == expected
</pre>
</div>
<div class="section" id="skip-benchmarks">
<h2>Skip Benchmarks</h2>
<p>You can skip benchmark if you want.
If you want skip benchmark, return a string (= reason to skip).</p>
<p>Example:</p>
<pre class="literal-block">
from benchmarker import Benchmarker

with Benchmarker(1000) as bench:

    @bench("Django template engine"):
    def _(bm):
        ## setup
        try:
            import django
            import django.template
        except ImportError:
            <strong>return "skip because not installed"</strong>    # !!!!!
        ...
        ...
        ...
</pre>
</div>
<div class="section" id="filter-benchmarks">
<h2>Filter Benchmarks</h2>
<p>Using command-line option <tt class="docutils literal"><span class="pre">-f</span></tt>, you can filter benchmarks by name.</p>
<p>Example:</p>
<pre class="literal-block">
$ python mybench.py <strong>-f 'name==foo'</strong>    # select benchmarks by name
$ python mybench.py <strong>-f 'name!=foo'</strong>    # reject benchmarks by name
$ python mybench.py <strong>-f 'name=~^foo$'</strong>  # select by pattern (regexp)
$ python mybench.py <strong>-f 'name!~^foo$'</strong>  # reject by pattern (regexp)
</pre>
</div>
<div class="section" id="user-defined-tags">
<h2>User-Defined Tags</h2>
<p><tt class="docutils literal">@bench()</tt> decorator can take user-defined tags.
They can be string or tuple of strings.</p>
<p>Example:</p>
<pre class="literal-block">
from benchmarker import Benchmarker

with Benchmarker(1000*1000) as bench:

    @bench("Kid template engine", <strong>tag="tooslow"</strong>):
    def _(bm):
        for i in bm:
            ....

    @bench("Tenjin template engine", <strong>tag=("fast","autoescape")</strong>):
    def _(bm):
        for i in bm:
            ....

    @bench("Django template engine"):
    def _(bm):
        for i in bm:
            ....
</pre>
<p>You can filter benchmarks by user-defined tags by <tt class="docutils literal"><span class="pre">-f</span></tt> option.</p>
<p>Example:</p>
<pre class="literal-block">
$ python mybench.py <strong>-f 'tag==fast'</strong>     # select only tagged as 'fast'
$ python mybench.py <strong>-f 'tag!=tooslow'</strong>  # reject all tagged as 'tooslow'
$ python mybench.py <strong>-f 'tag=~^fast$'</strong>   # select by pattern
$ python mybench.py <strong>-f 'tag!~^tooslo$'</strong> # reject by pattern
</pre>
</div>
</div>
</div>
</body>
</html>
